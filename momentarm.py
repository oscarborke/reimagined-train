import math


def beregn_sikksakk(sys, i):
    """Beregning av KL sikksakk, B1 og B2, samt max forskyvning, e."""

    r = i.radius

    # System avhengige sikksakk-verdier til innput i max masteavstand.
    # struktur i sikksakk-ordbøker under: { "radius": [B1, B2] } i [m]
    # max tillatt utblåsning, e [m], bestemmes i indre if-løkke.
    if sys.navn == "20a" or sys.navn == "20b":
        sikksakk = {"180": [-0.30, -0.30], "250": [-0.30, -0.30],
                    "300": [-0.30, -0.30], "400": [-0.30, -0.30],
                    "500": [-0.30, -0.30], "600": [-0.30, -0.30],
                    "700": [-0.30, -0.30], "800": [-0.30, -0.30],
                    "900": [-0.30, -0.30], "1000": [-0.30, -0.30],
                    "1100": [-0.30, -0.30], "1200": [-0.30, -0.30],
                    "1300": [-0.30, -0.30], "1400": [-0.30, -0.25],
                    "1500": [-0.30, -0.20], "1600": [-0.30, -0.20],
                    "1800": [-0.30, -0.15], "2000": [-0.30, -0.15],
                    "2400": [-0.30, -0.10], "2700": [-0.30, -0.10],
                    "3000": [-0.30, -0.10], "3500": [-0.30, -0.10],
                    "4000": [-0.30, -0.20], "5000": [-0.30, 0.30],
                    "7000": [-0.30, 0.30], "10000": [-0.30, 0.30],
                    "20000": [-0.30, 0.30], "10000000": [-0.30, 0.30]}
        if r <= 1000:
            e = 0.42
        elif 1000 < r <= 2000:
            e = 0.42 + (r - 1000) * ((0.50 - 0.42) / (2000 - 1000))
        elif 2000 < r <= 4000:
            e = 0.50 + (r - 2000) * ((0.55 - 0.50) / (4000 - 2000))
        else:
            e = 0.55
    elif sys.navn == "25":
        sikksakk = {"180": [-0.30, -0.30], "250": [-0.30, -0.30],
                    "300": [-0.30, -0.30], "400": [-0.30, -0.30],
                    "500": [-0.30, -0.30], "600": [-0.30, -0.30],
                    "700": [-0.30, -0.30], "800": [-0.30, -0.30],
                    "900": [-0.30, -0.30], "1000": [-0.30, -0.30],
                    "1100": [-0.30, -0.30], "1200": [-0.30, -0.30],
                    "1300": [-0.30, -0.30], "1400": [-0.30, -0.30],
                    "1500": [-0.30, -0.30], "1600": [-0.30, -0.30],
                    "1800": [-0.30, -0.29], "2000": [-0.30, -0.22],
                    "2400": [-0.30, -0.16], "2700": [-0.30, -0.13],
                    "3000": [-0.30, -0.13], "3500": [-0.30, -0.07],
                    "4000": [-0.30, -0.02], "5000": [-0.30, 0.28],
                    "7000": [-0.30, 0.19], "10000": [-0.30, 0.22],
                    "20000": [-0.30, 0.25], "10000000": [-0.30, 0.30]}
        if 180 <= r <= 300:
            e = 0.40 + (r - 180) * ((0.43 - 0.40) / (300 - 180))
        elif 300 < r <= 600:
            e = 0.43
        elif 600 < r <= 700:
            e = 0.43  + (r - 600) * ((0.44 - 0.43) / (700 - 600))
        elif 700 < r <= 900:
            e = 0.44
        elif 900 < r <= 1000:
            e = 0.44 + (r - 900) * ((0.45 - 0.44) / (1000 - 900))
        elif 1000 < r <= 2000:
            e = 0.45
        elif 2000 < r <= 3000:
            e = 0.45  + (r - 2000) * ((0.50 - 0.45) / (3000 - 2000))
        else:
            e = 0.50
    elif sys.navn == "35":
        sikksakk = {"180": [-0.4, -0.4], "250": [-0.4, -0.4],
                    "300": [-0.4, -0.4], "400": [-0.4, -0.4],
                    "500": [-0.4, -0.4], "600": [-0.4, -0.4],
                    "700": [-0.4, -0.4], "800": [-0.4, -0.4],
                    "900": [-0.4, -0.4], "1000": [-0.4, -0.4],
                    "1100": [-0.4, -0.4], "1200": [-0.4, -0.4],
                    "1300": [-0.4, -0.4], "1400": [-0.4, -0.4],
                    "1500": [-0.2, -0.2], "1600": [-0.2, -0.2],
                    "1800": [-0.2, -0.2], "2000": [-0.2, -0.2],
                    "2400": [-0.2, -0.2], "2700": [-0.2, -0.2],
                    "3000": [-0.2, -0.2], "3500": [-0.2, -0.2],
                    "4000": [-0.2, -0.2], "5000": [-0.4, 0.4],
                    "7000": [-0.4, 0.4], "10000": [-0.4, 0.4],
                    "20000": [-0.4, 0.4], "10000000": [-0.4, 0.4]}
        e = 0.7

    B1 = sikksakk[str(r)][0]
    B2 = sikksakk[str(r)][1]
    return B1, B2, e


def beregn_masteavstand(sys, i, B1, B2, q):
    """Beregning av tillatt masteavstand, a, mht utblåsning av KL."""

    e_per = 0.63                                        # [m]
    r = i.radius                                        # [m]
    s_kl = sys.kontakttraad["Strekk i ledning"] * 1000  # [N]

    # KL blåser UT fra kurven
    a1 = math.sqrt(((2 * s_kl) / (q - (s_kl / r))) * ((2 * e_per - B1 - B2)
                   + math.sqrt((2 * e_per - B1 - B2) ** 2 - (B1 - B2) ** 2)))

    # KL blåser INN i kurven
    a2 = math.sqrt(((2 * s_kl) / (q + (s_kl / r))) * ((2 * e_per + B1 + B2)
                   + math.sqrt((2 * e_per + B1 + B2) ** 2 - (B1 - B2) ** 2)))

    a = min(a1, a2)

    if a > 60 and sys.navn == "35":
        a = 60
        print(a)

    if a > 65 and (sys.navn == "25" or
                     sys.navn == "20a" or
                     sys.navn == "20b"):
        a = 65
        print(a)

    return a


def beregn_arm(i, B1):
    """Beregner momentarm a_T for strekk- eller trykkutligger."""

    r = i.radius
    b = abs(B1)
    a_T, a_T_dot = 0, 0  # Initialiserer momentarmvariabler

    # Overhøyde, UE i [m], pga kurveradius i [m]
    ue = {"180": 0.150, "250": 0.150, "300": 0.150, "400": 0.150,
          "500": 0.150, "600": 0.150, "700": 0.150, "800": 0.150,
          "900": 0.150, "1000": 0.135, "1100": 0.120, "1200": 0.120,
          "1300": 0.115, "1400": 0.110, "1500": 0.110, "1600": 0.110,
          "1800": 0.110, "2000": 0.100, "2400": 0.090, "2700": 0.080,
          "3000": 0.070, "3500": 0.060, "4000": 0.050, "5000": 0.040,
          "7000": 0.020, "10000": 0, "20000": 0, "10000000": 0}

    # -----------------------!!NB!!-----------------------------------#
    #
    #   Hva skal velges av (+)0.3  eller (-)0.3 i uttrykkene under ??
    #
    # ----------------------------------------------------------------#
    if i.strekkutligger:
        a_T = i.sms + i.fh * (ue[str(r)] / 1435) - b + 0.3

    # trykkutligger hvis ikke strekkutligger
    if not i.strekkutligger:
        a_T_dot = i.sms - i.fh * (ue[str(r)] / 1435) + b + 0.3

    return a_T, a_T_dot
